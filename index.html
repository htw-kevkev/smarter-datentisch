<!--
    Dieses Beispiel hilft, Koordinaten von der Karte zu bekommen:
    Bei einem Klick wird der Marker verschoben und zeigt seine
    Koordinaten im Popup!
    Achtung: Durch die manuelle Rotation und den Zoom entspricht der
    optische Klick auf dem Bildschirm nicht der Stelle, an der die
    Karte geklickt wird!

    Es ist möglich, Interaktivität ((Maus)Zoom, Dragging)
    einzuschalten. Dann wird bei einer Veränderung des Kartenausschnittes
    der neue Mittelpunkt in der linken Legende angezeigt.
-->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="include/leaflet.css" />
    <link rel="stylesheet" href="include/bootstrap.min.css" />

    <style>
        .map {
            cursor: auto;
            height: 100vh !important;
            width: 100vw !important;
            overflow: visible;
            /* rotate and zoom into the map element to match the model */
            transform: rotate(37.78deg) scale(1.353, 1.353);
        }

        .legend {
            background: rgba(248, 249, 250, 0.85) !important;
            overflow-y: auto;
            padding: 0.75rem;
            position: fixed;
            z-index: 2000;
        }
    </style>
</head>


<body style="overflow:hidden">
    <div id="map" class="map"></div>

    <div class="legend leaflet-container" style="height: 330px; width: 185px; top:705px;">
        <h3>Legende Links</h3>
        <b>Mittelpunkt</b>
        <div id="output"></div>
    </div>

    <div class="legend leaflet-container" style="height: 400px; width: 250px; top: 10px; right: 10px">
        <h3>Legende Rechts</h3>
        
        <!-- Checkbox freie Wohnungen -->
        <div class="form-group">
            <div class="form-check">
              <input id="filter_available_flats" class="filter form-check-input" type="checkbox" checked>
              <label for="filter_night_traffic">Freie Wohnungen</label>
            </div>
        </div>
        
        <div class="leaflet-tooltip-bottom text-center">
            <small>
                Visualisiert mit Leaflet<br>
                &copy; OpenStreetMap contributors
            </small>
        </div>
    </div>

    <script src="include/jquery-3.4.1.min.js"></script>
    <script src="include/leaflet.js"></script>
    <script src="include/d3-5.15.0.min.js"></script> <!-- add d3 to load csv or json data from local / remote -->
    <script>
        // Initialize map
        // comment-out an option to enable some map interactivity
        // Map: https://leafletjs.com/reference-1.7.1.html#map
        var map = L.map("map", {
            dragging: false,
            doubleClickZoom: false,
            scrollWheelZoom: false,
            attributionControl: false,
            zoomControl: false
        });

        // create function to output map center in left legend (empty div)
        // and run whenever the map was moved
        map.on("moveend", function () { $("#output").text(map.getCenter()); });

        // select a background 'tile' url
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map); // Openstreetmap
        // L.tileLayer('https://tiles.codefor.de/berlin-2019/{z}/{x}/{y}.png').addTo(map); // Luftbild 2019
    </script>

    <!-- <script>
        // Add JavaScript-code to generate a visualization with Leaflet
        // object map

        // Create draggable marker and add it to map
        // Marker: https://leafletjs.com/reference-1.7.1.html#marker
        var marker = L.marker([52.565332, 13.51989], { draggable: true }).addTo(map);

        marker.bindPopup("LatLng(52.565332, 13.51989)"); // add popup to marker

        // create function to set marker popup content
        // and run whenever the marker was moved
        marker.on("moveend", function () { this.setPopupContent(`${this.getLatLng()}`).openPopup(); }); // this = marker


        // create function to set marker popup content
        // and run whenever the map was clicked
        map.on("click", function (e) { marker.setLatLng(e.latlng).setPopupContent(`${marker.getLatLng()}`).openPopup(); }); // this = map
    </script> -->

    <script>
        // Add JavaScript-code to generate an interactve visualization with Leaflet object map
        // the loading of the data is initialized once the whole document is loaded
        
        // read the shapse.json file, i.e. a list, into json_data and execute the rendering function with it
        // the shapes.json is transferred from my server but its the same from the zip
        // d3.json("https://wosla.de/nhsh/workshop/shapes.json").then(function(json_data) {
        d3.json("immo.json").then(function(json_data) { // load file locally, this does not work out of the box
            // console.log(json_data);
            // run for-each loop over each list element from json_data
            // each element from shapes.json is a json "object",
            // i.e. it contains the 3 key: value-pairs type: t, coordinates c, options o
            
            //var flatArray = [];

            json_data.forEach(function(element) {
                // var lat = parseInt(element["Latitude"].replace('.',""),10)
                var lat = element["Latitude"].split('.').join("");
                var lng = element["Longitude"].split('.').join("");
                lat = lat[0]+lat[1]+"."+lat.substring(2, lat.size);
                lng = lng[0]+lng[1]+"."+lng.substring(2, lng.size);
                // console.log(lat);
                // console.log(lng);

                // print(lat)
                // L.circle([lat, lng], { "radius": 50, "fillColor": "ff0000", "fillOpacity": 0.5} ).addTo(map);
                L.marker([lat, lng]).addTo(map);
                //flatArray.append(element);
            });
        });
    </script>

    <script>
        // properly center map to match model
        // map.setView([52.565319, 13.520065], 16); // without bootstrap
        map.setView([52.565332, 13.51989], 16); // with bootstrap
    </script>
</body>
</html>
