<!--
    Dieses Beispiel hilft, Koordinaten von der Karte zu bekommen:
    Bei einem Klick wird der Marker verschoben und zeigt seine
    Koordinaten im Popup!
    Achtung: Durch die manuelle Rotation und den Zoom entspricht der
    optische Klick auf dem Bildschirm nicht der Stelle, an der die
    Karte geklickt wird!

    Es ist möglich, Interaktivität ((Maus)Zoom, Dragging)
    einzuschalten. Dann wird bei einer Veränderung des Kartenausschnittes
    der neue Mittelpunkt in der linken Legende angezeigt.
-->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="include/leaflet.css" />
    <link rel="stylesheet" href="include/bootstrap.min.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
    <style>
        .map {
            cursor: auto;
            height: 100vh !important;
            width: 100vw !important;
            overflow: visible;
            /* rotate and zoom into the map element to match the model */
            transform: rotate(37.78deg) scale(1.353, 1.353);
        }

        .legend {
            background: rgba(248, 249, 250, 0.85) !important;
            overflow-y: auto;
            padding: 0.75rem;
            position: fixed;
            z-index: 2000;
        }
    </style>
</head>


<body style="overflow:hidden">
    <div id="map" class="map"></div>
    <!--
    <div class="legend leaflet-container" style="height: 330px; width: 185px; top:705px;">
        <h3>Legende Links</h3>
        <b>Mittelpunkt</b>
        <div id="output"></div>
    </div>
        -->
    <div class="legend leaflet-container" style="height: 400px; width: 250px; top: 10px; right: 10px">
        <h3>Legende Rechts</h3>

        <!-- Checkbox freie Wohnungen -->
        <div class="form-group">
            <div class="form-check">
                <input id="filter_wohnungen" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Wohnung')">
                <label for="wohnung-label">Freie Wohnungen</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_schule" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Schule')">
                <label for="schule-label">Schule</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_kita" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Kindergarten')">
                <label for="kita-label">Kindergarten</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_supermarkt" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Supermarkt')">
                <label for="supermarkt-label">Supermarkt</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_beacker" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Bäcker')">
                <label for="baecker-label">Bäcker</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_spielplatz" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Spielplatz')">
                <label for="spielplatz-label">Spielplatz</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_bank" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Bank')">
                <label for="bank-label">Bank</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_post" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Post')">
                <label for="post-label">Post</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_arzt" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Arzt')">
                <label for="arzt-label">Arzt</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_busstop" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Bushaltestelle')">
                <label for="busstop-label">Bushaltestelle</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_tramstop" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Tramhaltestelle')">
                <label for="tramstop-label">Tramhaltestelle</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_subwaystop" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('S-Bahnhof')">
                <label for="subwaystop-label">S-Bahnhof</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_neighborhoodcenter" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Nachbarschaftszentrum')">
                <label for="neighborhoodCenter-label">Nachbarschaftszentrum</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_outpatientcare" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Ambulante Versorgung')">
                <label for="outpatientcare-label">Ambulante Versorgung</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_pharmacy" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Apotheke')">
                <label for="pharmacy-label">Apotheke</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_chargingstation" class="filter form-check-input" type="checkbox" onclick="onclickedCheckBox('Ladesaeule')">
                <label for="chargingstation-label">Ladesaeule</label>
            </div>
        </div>

        <div class="form-group">
            <div class="form-check">
                <input id="filter_sabine" class="filter form-check-input" type="checkbox" onclick="onclickedSabine()">
                <label for="sabine-label"><i class="fas fa-female"></i> Sabine</label>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input id="filter_matthias" class="filter form-check-input" type="checkbox" onclick="onclickedMatthias()">
                <label for="matthias-label"><i class="fas fa-male"></i> Matthias</label>
            </div>
        </div>
        <div class="leaflet-tooltip-bottom text-center">
            <small>
                Visualisiert mit Leaflet<br>
                &copy; OpenStreetMap contributors
            </small>
        </div>

    </div>

    <script src="include/jquery-3.4.1.min.js"></script>
    <script src="include/leaflet.js"></script>
    <script src="include/d3-5.15.0.min.js"></script> <!-- add d3 to load csv or json data from local / remote -->

    <script src="include/Leaflet.Icon.Glyph.js"></script><!--add icon in marker-->
    <script>
        var map = L.map("map", {
            dragging: false,
            doubleClickZoom: false,
            scrollWheelZoom: false,
            attributionControl: false,
            zoomControl: false
        });

        // create function to output map center in left legend (empty div)
        // and run whenever the map was moved
        map.on("moveend", function () { $("#output").text(map.getCenter()); });

        // select a background 'tile' url
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map); // Openstreetmap
        // L.tileLayer('https://tiles.codefor.de/berlin-2019/{z}/{x}/{y}.png').addTo(map); // Luftbild 2019

        // create array:
        var wohnungMarkers = new Array();//Freie Wohnungen

        var schuleMarkers = new Array();
        var kitaMarkers = new Array();
        var supermarktMarkers = new Array();
        var baeckerMarkers = new Array();
        var spielplatzMarkers = new Array();
        var bankMarkers = new Array();
        var postMarkers = new Array();
        var arztMarkers = new Array();
        var busstopsMarkers = new Array();
        var tramstopsMarkers = new Array();
        var subwaystopsMarkers = new Array();
        var neighborhoodcenterMarkers = new Array();
        var outpatientcareMarkers = new Array();
        var pharmacysMarkers = new Array();
        var chargingstationMarkers = new Array();

        var initMarkers = function () {
            d3.json("ObjectsWithCategories.json").then(function (json_data) {

                console.log(json_data);

                var features = json_data.features;
                for (i = 0; i < features.length; i++) {
                    var item = features[i];
                    var category = item.properties.category;
                    console.log(item.geometry.coordinates)
                    /*var lat = item.geometry.coordinates[0].toString().split('.').join("");
                    var lng = item.geometry.coordinates[1].toString().split('.').join("");
                    lat = lat[0] + lat[1] + "." + lat.substring(2, lat.size);
                    lng = lng[0] + lng[1] + "." + lng.substring(2, lng.size);*/
                    var lat = item.geometry.coordinates[1];
                    var lng = item.geometry.coordinates[0];

                    if (category == "Wohnung") {

                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'home' }) });
                        wohnungMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Schule") {

                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'school' }) });
                        //var marker = L.marker([lat, lng]);
                        schuleMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Kindergarten") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'child' }) });
                        //var marker = L.marker([lat, lng]);
                        kitaMarkers.push({ Marker: marker, Value: item });

                    } else if (category == "Supermarkt") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'shopping-cart' }) });
                        //var marker = L.marker([lat, lng]);
                        supermarktMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Bäcker") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'bread-slice' }) });
                        baeckerMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Spielplatz") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'playstation' }) });
                        spielplatzMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Bank") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'piggy-bank' }) });
                        bankMarkers.push({ Marker: marker, Value: item });

                    } else if (category == "Post") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'mail-bulk' }) });
                        postMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Arzt") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'briefcase-medical' }) });
                        arztMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Bushaltestelle") {

                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'bus' }) });
                        busstopsMarkers.push({ Marker: marker, Value: item });

                    } else if (category == "Tramhaltestelle") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'train' }) });
                        tramstopsMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "S-Bahnhof") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'subway' }) });
                        subwaystopsMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Nachbarschaftszentrum") {
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'house-user' }) });
                        neighborhoodcenterMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Ambulante Versorgung") {

                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'house-user' }) });
                        outpatientcareMarkers.push({ Marker: marker, Value: item });
                    } else if (category == "Apotheke") {
                        pharmacysMarkers.push({ Marker: marker, Value: item });
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'prescription-bottle-alt' }) });
                    } else if (category == "Ladesaeule") {
                        chargingstationMarkers.push({ Marker: marker, Value: item });
                        var marker = L.marker([lat, lng], { icon: L.icon.glyph({ prefix: 'fas', glyph: 'charging-station' }) });
                    }
                }
            });
        };

        initMarkers();


     

    </script>

    <!-- <script>
        // Add JavaScript-code to generate a visualization with Leaflet
        // object map

        // Create draggable marker and add it to map
        // Marker: https://leafletjs.com/reference-1.7.1.html#marker
        var marker = L.marker([52.565332, 13.51989], { draggable: true }).addTo(map);

        marker.bindPopup("LatLng(52.565332, 13.51989)"); // add popup to marker

        // create function to set marker popup content
        // and run whenever the marker was moved
        marker.on("moveend", function () { this.setPopupContent(`${this.getLatLng()}`).openPopup(); }); // this = marker


        // create function to set marker popup content
        // and run whenever the map was clicked
        map.on("click", function (e) { marker.setLatLng(e.latlng).setPopupContent(`${marker.getLatLng()}`).openPopup(); }); // this = map
    </script> -->

    <script>
        // Add JavaScript-code to generate an interactve visualization with Leaflet object map
        // the loading of the data is initialized once the whole document is loaded

        // read the shapse.json file, i.e. a list, into json_data and execute the rendering function with it
        // the shapes.json is transferred from my server but its the same from the zip
        // d3.json("https://wosla.de/nhsh/workshop/shapes.json").then(function(json_data) {


        //todo add typ
        var removeMarkers = function (_makers) {
            for (i = 0; i < _makers.length; i++) {
                map.removeLayer(_makers[i].Marker);
            }
        }
        var onclickedSabine = function () {

        }
        var onclickedCheckBox = function (_cate) {
            var makers = new Array();
            var checkboxValue = undefined;

            if (_cate == "Wohnung") {
                checkboxValue = document.getElementById("filter_wohnungen");
                makers = wohnungMarkers;
            } else if (_cate == "Schule") {
                checkboxValue = document.getElementById("filter_schule");
                makers = schuleMarkers;
            } else if (_cate == "Kindergarten") {
                checkboxValue = document.getElementById("filter_kita");
                makers = kitaMarkers;
            } else if (_cate == "Supermarkt") {
                checkboxValue = document.getElementById("filter_supermarkt");
                makers = supermarktMarkers;
            } else if (_cate == "Bäcker") {
                checkboxValue = document.getElementById("filter_beacker");
                makers = baeckerMarkers;
            } else if (_cate == "Spielplatz") {
                checkboxValue = document.getElementById("filter_spielplatz");
                makers = spielplatzMarkers;
            } else if (_cate == "Bank") {
                checkboxValue = document.getElementById("filter_bank");
                makers = bankMarkers;
            } else if (_cate == "Post") {
                checkboxValue = document.getElementById("filter_post");
                makers = postMarkers;
            } else if (_cate == "Arzt") {
                checkboxValue = document.getElementById("filter_arzt");
                makers = arztMarkers;
            } else if (_cate == "Bushaltestelle") {
                checkboxValue = document.getElementById("filter_busstop");
                makers = busstopsMarkers;
            } else if (_cate == "Tramhaltestelle") {
                checkboxValue = document.getElementById("filter_tramstop");
                makers = tramstopsMarkers;
            } else if (_cate == "S-Bahnhof") {
                checkboxValue = document.getElementById("filter_subwaystop");
                makers = subwaystopsMarkers;
            } else if (_cate == "Nachbarschaftszentrum") {
                checkboxValue = document.getElementById("filter_neighborhoodcenter");
                makers = neighborhoodcenterMarkers;
            } else if (_cate == "Ambulante Versorgung") {
                checkboxValue = document.getElementById("filter_outpatientcare");
                makers = outpatientcareMarkers;
            } else if (_cate == "Apotheke") {
                checkboxValue = document.getElementById("filter_pharmacy");
                makers = pharmacysMarkers;
            } else if (_cate == "Ladesaeule") {
                checkboxValue = document.getElementById("filter_chargingstation");
                makers = chargingstationMarkers;
            }

            if (checkboxValue.checked == true) {
                //console.log(makers);

             

                makers.forEach(function (element) {
                    var marker = element.Marker;
                    var value = element.Value;
                    var adresse = value.properties.Adresse;
                    if (adresse == undefined || adresse == null) adresse = "Keine vorhanden";
                    console.log(value);
                    map.addLayer(marker);
                    marker.addTo(map)
                        .bindTooltip("Adresse: " + adresse);
                });
            } else {
                removeMarkers(makers);//todo with typ
            }
        }

    </script>

    <script>
        // properly center map to match model
        // map.setView([52.565319, 13.520065], 16); // without bootstrap
        map.setView([52.565332, 13.51989], 16); // with bootstrap
    </script>
</body>
</html>
